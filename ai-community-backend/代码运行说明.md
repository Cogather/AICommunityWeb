# AI社区后端代码运行说明

## 一、环境要求

### 1. 开发环境
- **JDK**: 1.8 或更高版本
- **Maven**: 3.6 或更高版本
- **MySQL**: 5.7 或更高版本
- **IDE**: IntelliJ IDEA 或 Eclipse（推荐IntelliJ IDEA）

### 2. 系统要求
- **操作系统**: Windows 10/11、macOS、Linux
- **内存**: 至少 4GB RAM
- **磁盘空间**: 至少 500MB 可用空间

## 二、依赖安装

### 1. 安装JDK
```bash
# 检查JDK版本
java -version

# 如果未安装，请下载并安装JDK 1.8或更高版本
# 下载地址：https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html
```

### 2. 安装Maven
```bash
# 检查Maven版本
mvn -version

# 如果未安装，请下载并安装Maven 3.6或更高版本
# 下载地址：https://maven.apache.org/download.cgi
```

### 3. 安装MySQL
```bash
# 检查MySQL版本
mysql --version

# 如果未安装，请下载并安装MySQL 5.7或更高版本
# 下载地址：https://dev.mysql.com/downloads/mysql/5.7.html
```

## 三、数据库初始化

### 1. 创建数据库
```sql
-- 登录MySQL
mysql -u root -p

-- 创建数据库
CREATE DATABASE ai_community DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

-- 退出MySQL
exit;
```

### 2. 执行建表语句
```bash
# 方式1：使用命令行执行
mysql -u root -p ai_community < src/main/resources/db/schema.sql

# 方式2：在MySQL客户端中执行
# 打开 src/main/resources/db/schema.sql 文件，复制所有SQL语句，在MySQL客户端中执行
```

### 3. 验证数据库
```sql
-- 登录MySQL
mysql -u root -p ai_community

-- 查看所有表
SHOW TABLES;

-- 应该看到以下表：
-- users, user_roles, posts, tags, post_tags, comments, replies, likes, favorites
-- activities, activity_registrations, tools, tool_banners, awards, honors
-- honor_flowers, messages, home_carousel, honor_config, news
-- recommended_covers, agent_featured_post, points_records, drafts
```

## 四、配置文件修改

### 1. 修改数据库连接配置
编辑 `src/main/resources/application.yml` 文件：

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/ai_community?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: root        # 修改为你的MySQL用户名
    password: root        # 修改为你的MySQL密码
```

### 2. 修改开发环境配置（可选）
编辑 `src/main/resources/application-dev.yml` 文件，修改开发环境的数据库连接配置。

## 五、启动方式

### 方式1：使用Maven命令启动（推荐）

```bash
# 1. 进入项目根目录
cd ai-community-backend

# 2. 编译项目
mvn clean compile

# 3. 运行项目
mvn spring-boot:run

# 或者指定配置文件运行
mvn spring-boot:run -Dspring-boot.run.profiles=dev
```

### 方式2：打包后运行

```bash
# 1. 打包项目
mvn clean package

# 2. 运行jar包
java -jar target/ai-community-backend-1.0.0.jar

# 或者指定配置文件运行
java -jar target/ai-community-backend-1.0.0.jar --spring.profiles.active=dev
```

### 方式3：使用IDE启动

1. **IntelliJ IDEA**:
   - 打开项目：File -> Open -> 选择项目目录
   - 等待Maven依赖下载完成
   - 找到 `Application.java` 文件
   - 右键 -> Run 'Application.main()'

2. **Eclipse**:
   - 导入项目：File -> Import -> Existing Maven Projects
   - 等待Maven依赖下载完成
   - 找到 `Application.java` 文件
   - 右键 -> Run As -> Java Application

## 六、验证启动

### 1. 检查启动日志
启动成功后，控制台应该显示：
```
Started Application in X.XXX seconds (JVM running for X.XXX)
```

### 2. 访问Swagger文档
打开浏览器，访问：
```
http://localhost:8080/api/swagger-ui.html
```

如果能看到Swagger UI界面，说明启动成功。

### 3. 测试接口
在Swagger UI中测试登录接口：
- 接口路径：`POST /api/auth/login`
- 请求参数：
```json
{
  "username": "test",
  "password": "123456"
}
```

## 七、Swagger文档访问地址

- **Swagger UI**: http://localhost:8080/api/swagger-ui.html
- **Swagger JSON**: http://localhost:8080/api/v2/api-docs

## 八、常见问题

### 1. 端口被占用
**问题**: 启动时报错 `Port 8080 is already in use`

**解决方案**:
- 修改 `application.yml` 中的端口号：
```yaml
server:
  port: 8081  # 修改为其他端口
```

### 2. 数据库连接失败
**问题**: 启动时报错 `Communications link failure`

**解决方案**:
- 检查MySQL服务是否启动
- 检查数据库连接配置是否正确
- 检查MySQL用户权限

### 3. Maven依赖下载失败
**问题**: Maven依赖下载超时或失败

**解决方案**:
- 检查网络连接
- 配置Maven镜像（推荐使用阿里云镜像）
- 删除本地Maven仓库中的相关依赖，重新下载

### 4. 编译错误
**问题**: 编译时报错找不到类或方法

**解决方案**:
- 执行 `mvn clean install` 重新编译
- 检查JDK版本是否为1.8或更高
- 检查IDE的JDK配置

## 九、开发建议

### 1. 代码规范
- 严格遵循《阿里巴巴Java开发手册（最新版）》规范
- 使用Lombok简化代码
- 统一使用Result包装返回结果
- 统一异常处理

### 2. 数据库操作
- 使用MyBatis的#{}防止SQL注入
- 复杂查询使用XML文件编写SQL
- 合理使用索引提升查询性能

### 3. 接口开发
- 所有接口添加Swagger注解
- 使用@Valid进行参数校验
- 统一返回格式
- 合理使用分页

### 4. 测试
- 编写单元测试
- 使用Swagger UI进行接口测试
- 进行前后端联调测试

## 十、后续开发

### 待完善功能
1. **JWT认证**: 完善JWT token生成和验证机制
2. **权限控制**: 实现基于角色的权限控制（RBAC）
3. **文件上传**: 实现文件上传功能
4. **缓存机制**: 集成Redis实现缓存
5. **消息推送**: 实现WebSocket实时消息推送
6. **日志系统**: 集成日志系统
7. **单元测试**: 编写单元测试和集成测试
8. **API限流**: 实现API限流机制

### 扩展建议
1. 集成Spring Security实现安全认证
2. 使用Redis实现分布式缓存
3. 使用RabbitMQ实现异步消息处理
4. 集成Elasticsearch实现全文搜索
5. 使用Docker容器化部署
6. 集成Prometheus实现监控

## 十一、项目结构说明

```
ai-community-backend/
├── src/
│   ├── main/
│   │   ├── java/
│   │   │   └── com/aicommunity/
│   │   │       ├── Application.java          # 启动类
│   │   │       ├── common/                   # 通用组件
│   │   │       ├── config/                   # 配置类
│   │   │       ├── controller/               # 控制器层
│   │   │       ├── dto/                      # 数据传输对象
│   │   │       ├── entity/                   # 实体类
│   │   │       ├── mapper/                   # Mapper接口
│   │   │       └── service/                 # 服务层
│   │   └── resources/
│   │       ├── application.yml              # 主配置文件
│   │       ├── application-dev.yml          # 开发环境配置
│   │       ├── mapper/                       # MyBatis XML文件
│   │       └── db/
│   │           └── schema.sql               # 数据库建表语句
│   └── test/                                 # 测试代码
├── pom.xml                                    # Maven配置文件
├── README.md                                  # 项目说明文档
├── 接口映射清单.md                            # 接口映射清单
└── 代码运行说明.md                            # 本文档
```

## 十二、联系方式

如有问题，请联系开发团队：dev@aicommunity.com
