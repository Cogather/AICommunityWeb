# 个人中心接口文档

## 概述

本文档定义了AI社区Web平台个人中心页面相关的API接口，包括用户平台信息、个人积分、发布的帖子、收藏、评论、参与的活动、发布的活动等。

---

## 接口概览

| 接口 | 方法 | 说明 |
|------|------|------|
| GET /api/user/profile | GET | 获取用户平台信息 |
| GET /api/user/points | GET | 获取用户积分信息 |
| GET /api/user/{userId}/posts | GET | 获取用户发布的帖子列表 |
| GET /api/user/{userId}/favorites | GET | 获取用户收藏的帖子列表 |
| GET /api/user/{userId}/comments | GET | 获取用户评论列表 |
| GET /api/user/{userId}/activities | GET | 获取用户参与的活动列表 |
| GET /api/user/{userId}/created-activities | GET | 获取用户发布的活动列表 |
| GET /api/activities/{activityId}/registrations | GET | 获取活动报名用户列表 |

---

## 接口详情

### 1. 获取用户平台信息

获取当前用户或指定用户的平台信息，包括统计数据、积分、花朵数等。

**请求**

```
GET /api/user/profile
GET /api/user/{userId}/profile
```

**请求参数**

| 参数 | 类型 | 位置 | 必填 | 说明 |
|-----|------|------|------|------|
| userId | number | path | 否 | 用户ID，不传则获取当前登录用户 |

**响应**

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "employeeId": "E001",
    "name": "张三",
    "avatar": "https://example.com/avatars/user1.jpg",
    "bio": "AI技术爱好者",
    "department": "技术部/AI研发中心/智能应用组",
    "departments": {
      "level1": { "id": 100, "name": "技术部", "level": 1 },
      "level2": { "id": 110, "name": "AI研发中心", "level": 2 },
      "level3": { "id": 111, "name": "智能应用组", "level": 3 }
    },
    "postsCount": 15,
    "favoritesCount": 32,
    "commentsCount": 48,
    "activitiesCount": 5,
    "flowersCount": 120,
    "points": 2500,
    "roles": ["admin", "user"]
  }
}
```

**响应字段说明**

| 字段 | 类型 | 说明 |
|-----|------|------|
| id | number | 用户ID |
| employeeId | string | 工号 |
| name | string | 姓名 |
| avatar | string | 头像URL |
| bio | string | 个人简介 |
| department | string | 完整部门路径 |
| departments | object | 多级部门详细信息 |
| postsCount | number | 发布帖子数 |
| favoritesCount | number | 收藏数 |
| commentsCount | number | 评论数 |
| activitiesCount | number | 参与活动数 |
| flowersCount | number | 获得小红花数 |
| points | number | 平台积分 |
| roles | array | 用户角色列表 |

---

### 2. 获取用户积分信息

获取用户的积分详情，包括当前积分、积分来源、积分历史等。

**请求**

```
GET /api/user/points
GET /api/user/{userId}/points
```

**响应**

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "totalPoints": 2500,
    "monthlyPoints": 350,
    "ranking": 15,
    "pointsHistory": [
      {
        "id": 1,
        "type": "post_publish",
        "points": 50,
        "description": "发布帖子《AI技术实践分享》",
        "createdAt": "2026-01-10T10:30:00Z"
      },
      {
        "id": 2,
        "type": "comment",
        "points": 5,
        "description": "发表评论",
        "createdAt": "2026-01-10T11:00:00Z"
      },
      {
        "id": 3,
        "type": "like_received",
        "points": 2,
        "description": "帖子获得点赞",
        "createdAt": "2026-01-10T14:00:00Z"
      }
    ],
    "pointsRules": [
      { "action": "post_publish", "points": 50, "description": "发布帖子" },
      { "action": "comment", "points": 5, "description": "发表评论" },
      { "action": "like_received", "points": 2, "description": "帖子获得点赞" },
      { "action": "activity_join", "points": 10, "description": "参与活动" },
      { "action": "flower_received", "points": 10, "description": "获得小红花" }
    ]
  }
}
```

**响应字段说明**

| 字段 | 类型 | 说明 |
|-----|------|------|
| totalPoints | number | 总积分 |
| monthlyPoints | number | 本月积分 |
| ranking | number | 积分排名 |
| pointsHistory | array | 积分变动历史 |
| pointsRules | array | 积分规则说明 |

---

### 3. 获取用户发布的帖子列表

获取指定用户发布的所有帖子。

**请求**

```
GET /api/user/{userId}/posts
```

**请求参数**

| 参数 | 类型 | 位置 | 必填 | 说明 |
|-----|------|------|------|------|
| userId | number | path | 是 | 用户ID |
| page | number | query | 否 | 页码，默认1 |
| pageSize | number | query | 否 | 每页数量，默认15 |

**响应**

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 101,
        "title": "AI技术实践分享",
        "description": "分享我在AI技术实践中的一些心得...",
        "author": "张三",
        "authorId": 1,
        "authorAvatar": "https://example.com/avatars/user1.jpg",
        "cover": "https://example.com/covers/post1.jpg",
        "image": "https://example.com/images/post1.jpg",
        "views": 1200,
        "likes": 85,
        "comments": 23,
        "tags": ["AI", "实践"],
        "zone": "practices",
        "createTime": "2026-01-10T10:30:00Z"
      }
    ],
    "total": 15,
    "page": 1,
    "pageSize": 15
  }
}
```

---

### 4. 获取用户收藏的帖子列表

获取指定用户收藏的所有帖子。

**请求**

```
GET /api/user/{userId}/favorites
```

**请求参数**

| 参数 | 类型 | 位置 | 必填 | 说明 |
|-----|------|------|------|------|
| userId | number | path | 是 | 用户ID |
| page | number | query | 否 | 页码，默认1 |
| pageSize | number | query | 否 | 每页数量，默认15 |

**响应**

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 102,
        "title": "使用扶摇Agent实现智能代码生成",
        "description": "详细介绍如何使用扶摇Agent...",
        "author": "李四",
        "authorId": 2,
        "authorAvatar": "https://example.com/avatars/user2.jpg",
        "cover": "https://example.com/covers/post2.jpg",
        "views": 800,
        "likes": 65,
        "comments": 18,
        "tags": ["扶摇Agent", "代码生成"],
        "zone": "agent",
        "createTime": "2026-01-08T14:00:00Z",
        "favoriteTime": "2026-01-09T09:00:00Z"
      }
    ],
    "total": 32,
    "page": 1,
    "pageSize": 15
  }
}
```

**额外字段说明**

| 字段 | 类型 | 说明 |
|-----|------|------|
| favoriteTime | string | 收藏时间 |

---

### 5. 获取用户评论列表

获取指定用户发表的所有评论。

**请求**

```
GET /api/user/{userId}/comments
```

**请求参数**

| 参数 | 类型 | 位置 | 必填 | 说明 |
|-----|------|------|------|------|
| userId | number | path | 是 | 用户ID |
| page | number | query | 否 | 页码，默认1 |
| pageSize | number | query | 否 | 每页数量，默认15 |

**响应**

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1001,
        "content": "非常详细的分享，学到很多！",
        "postId": 101,
        "postTitle": "AI技术实践分享",
        "userId": 1,
        "userName": "张三",
        "userAvatar": "https://example.com/avatars/user1.jpg",
        "likes": 12,
        "createTime": "2026-01-10T15:30:00Z"
      }
    ],
    "total": 48,
    "page": 1,
    "pageSize": 15
  }
}
```

**响应字段说明**

| 字段 | 类型 | 说明 |
|-----|------|------|
| id | number | 评论ID |
| content | string | 评论内容 |
| postId | number | 所属帖子ID |
| postTitle | string | 所属帖子标题 |
| userId | number | 评论者ID |
| userName | string | 评论者姓名 |
| userAvatar | string | 评论者头像 |
| likes | number | 评论点赞数 |
| createTime | string | 评论时间 |

---

### 6. 获取用户参与的活动列表

获取指定用户报名参与的所有活动。

**请求**

```
GET /api/user/{userId}/activities
```

**请求参数**

| 参数 | 类型 | 位置 | 必填 | 说明 |
|-----|------|------|------|------|
| userId | number | path | 是 | 用户ID |
| page | number | query | 否 | 页码，默认1 |
| pageSize | number | query | 否 | 每页数量，默认15 |

**响应**

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "title": "扶摇Agent新手入门培训",
        "description": "面向新用户的扶摇Agent使用培训...",
        "image": "https://example.com/activities/activity1.jpg",
        "cover": "https://example.com/activities/activity1.jpg",
        "date": "2026-01-15 14:00",
        "location": "线上会议",
        "type": "training",
        "status": "upcoming",
        "registeredCount": 45
      }
    ],
    "total": 5,
    "page": 1,
    "pageSize": 15
  }
}
```

---

### 7. 获取用户发布的活动列表

获取指定用户作为活动发起人发布的所有活动。

**请求**

```
GET /api/user/{userId}/created-activities
```

**请求参数**

| 参数 | 类型 | 位置 | 必填 | 说明 |
|-----|------|------|------|------|
| userId | number | path | 是 | 用户ID |
| page | number | query | 否 | 页码，默认1 |
| pageSize | number | query | 否 | 每页数量，默认15 |

**响应**

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 2,
        "title": "AI工具使用技巧分享会",
        "description": "分享各种AI工具的使用技巧...",
        "content": "详细内容...",
        "cover": "https://example.com/activities/activity2.jpg",
        "date": "2026-01-20 15:00",
        "location": "A座会议室",
        "type": "sharing",
        "status": "ongoing",
        "registeredCount": 28,
        "maxRegistrations": 50,
        "creatorId": 1,
        "creatorName": "张三"
      }
    ],
    "total": 3,
    "page": 1,
    "pageSize": 15
  }
}
```

**额外字段说明**

| 字段 | 类型 | 说明 |
|-----|------|------|
| content | string | 活动详细内容 |
| maxRegistrations | number | 最大报名人数 |
| creatorId | number | 创建者ID |
| creatorName | string | 创建者姓名 |

---

### 8. 获取活动报名用户列表

获取指定活动的所有报名用户信息。

**请求**

```
GET /api/activities/{activityId}/registrations
```

**请求参数**

| 参数 | 类型 | 位置 | 必填 | 说明 |
|-----|------|------|------|------|
| activityId | number | path | 是 | 活动ID |
| page | number | query | 否 | 页码，默认1 |
| pageSize | number | query | 否 | 每页数量，默认100 |

**响应**

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "userId": 2,
        "userName": "李四",
        "userAvatar": "https://example.com/avatars/user2.jpg",
        "employeeId": "E002",
        "department": "技术部/研发中心",
        "registerTime": "2026-01-12T10:30:00Z"
      },
      {
        "id": 2,
        "userId": 3,
        "userName": "王五",
        "userAvatar": "https://example.com/avatars/user3.jpg",
        "employeeId": "E003",
        "department": "产品部",
        "registerTime": "2026-01-12T11:20:00Z"
      }
    ],
    "total": 28,
    "page": 1,
    "pageSize": 100
  }
}
```

**响应字段说明**

| 字段 | 类型 | 说明 |
|-----|------|------|
| id | number | 报名记录ID |
| userId | number | 用户ID |
| userName | string | 用户姓名 |
| userAvatar | string | 用户头像 |
| employeeId | string | 工号 |
| department | string | 部门 |
| registerTime | string | 报名时间 |

---

## 数据字典

### 活动类型

| 类型 | 值 | 说明 |
|-----|-----|------|
| 培训 | training | 培训类活动 |
| 竞赛 | competition | 竞赛类活动 |
| 分享 | sharing | 分享会 |
| 工作坊 | workshop | 工作坊 |
| 活动 | activity | 一般活动 |

### 活动状态

| 状态 | 值 | 说明 |
|-----|-----|------|
| 即将开始 | upcoming | 活动尚未开始 |
| 进行中 | ongoing | 活动进行中 |
| 已结束 | ended | 活动已结束 |

### 积分类型

| 类型 | 值 | 积分 | 说明 |
|-----|-----|------|------|
| 发布帖子 | post_publish | +50 | 发布一篇帖子 |
| 发表评论 | comment | +5 | 发表评论 |
| 获得点赞 | like_received | +2 | 帖子被点赞 |
| 参与活动 | activity_join | +10 | 报名参与活动 |
| 获得小红花 | flower_received | +10 | 获得小红花奖励 |
| 帖子被收藏 | favorite_received | +5 | 帖子被他人收藏 |

---

## 前端使用示例

### 加载个人中心数据

```typescript
import {
  getCurrentUser,
  getUserProfileByName,
  getUserPosts,
  getUserFavorites,
  getUserComments,
  getUserActivities,
  getUserCreatedActivities
} from '../mock'

// 加载当前用户数据
const loadUserData = async () => {
  const profile = await getCurrentUser()
  
  // 并行加载所有数据
  const [posts, favorites, comments, activities, createdActivities] = await Promise.all([
    getUserPosts(profile.id, { page: 1, pageSize: 100 }),
    getUserFavorites(profile.id, { page: 1, pageSize: 100 }),
    getUserComments(profile.id, { page: 1, pageSize: 100 }),
    getUserActivities(profile.id, { page: 1, pageSize: 100 }),
    getUserCreatedActivities(profile.id, { page: 1, pageSize: 100 })
  ])
  
  return {
    profile,
    posts: posts.list,
    favorites: favorites.list,
    comments: comments.list,
    activities: activities.list,
    createdActivities: createdActivities.list
  }
}

// 查看其他用户资料
const loadOtherUserProfile = async (userName: string) => {
  const profile = await getUserProfileByName(userName)
  // 加载该用户的公开数据
  // ...
}
```

### 获取活动报名详情

```typescript
import { getRegistrations } from '../mock'

const handleViewRegistrations = async (activityId: number) => {
  const response = await getRegistrations(activityId, { page: 1, pageSize: 100 })
  registrations.value = response.list
  totalRegistrations.value = response.total
}
```

---

## TypeScript类型定义

```typescript
// 用户平台信息
export interface UserProfile {
  id: number
  employeeId?: string
  name: string
  avatar: string
  bio?: string
  department?: string
  departments?: {
    level1?: DepartmentInfo
    level2?: DepartmentInfo
    level3?: DepartmentInfo
    level4?: DepartmentInfo
    level5?: DepartmentInfo
    level6?: DepartmentInfo
  }
  postsCount: number
  favoritesCount: number
  commentsCount: number
  activitiesCount: number
  flowersCount: number
  points: number
  roles?: string[]
}

// 评论信息
export interface UserComment {
  id: number
  content: string
  postId: number
  postTitle: string
  userId: number
  userName: string
  userAvatar: string
  likes: number
  createTime: string | Date
}

// 报名信息
export interface Registration {
  id: number
  userId: number
  userName: string
  userAvatar: string
  employeeId?: string
  department?: string
  registerTime: string
}

// 积分历史记录
export interface PointsHistory {
  id: number
  type: string
  points: number
  description: string
  createdAt: string
}

// 分页结果
export interface PageResult<T> {
  list: T[]
  total: number
  page: number
  pageSize: number
}
```
